<!DOCTYPE HTML>
<html>
	<head>
		<title>Bharatiya Temple Claims</title>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/component.css" />
		<link rel="stylesheet" href="assets/css/dataTables.min.css" />
		<link rel="stylesheet" href="assets/css/pikaday.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<script src="assets/js/modernizr.custom.js"></script>
	</head>
	<body class="is-loading body-no-bg">
		<form id="frmHome" method="post" action="#">
			<!-- Wrapper -->
			<div class="md-perspective md-modal md-effect-16" id="divNewClaim">
					<div class="md-content">
						<h3><i class="fa fa-times md-close nav-right"></i>New Expense Claim</h3>
							<div class="section nav-center">
								<p>Complete the below details to submit a claim</p>
							</div>
						<div class="section group">	
								<input class="icon" type="text" name="username" id="strSubmittedBy" disabled="true" placeholder="&#xf007; submitted by" />
						</div>
						<div class="section group">
							<div class="col span_1_of_2">
								<input class="icon"	type="text" name="checkname" id="strCheckFName" placeholder="&#xf007; recipient's first name" />
							</div>
							<div class="col span_1_of_2">
								<input class="icon"	type="text" name="checkname" id="strCheckLName" placeholder="&#xf007; recipient's last name" />
							</div>
						</div>
						<div class="section group">
							<div><input class="icon" type="text" name="address" id="strAddress" placeholder="&#xf015; address" /></div>
						</div>
						<div class="section group">
							<div class="col span_1_of_3">
								<input  type="text" name="city" id="strCity" placeholder="city" />
							</div>
							<div class="col span_1_of_3">
								<input  type="text" name="state" id="strState" placeholder="state" />
							</div>
							<div class="col span_1_of_3">
								<input  type="text" name="zip" id="strZip" placeholder="zip" />
							</div>
						</div>
						<div class="section group">
							<div class="col span_1_of_2">
								<input class="icon" type="text" name="amount" id="strAmount" placeholder="&#xf155; amount" />
							</div>
							<div class="col span_1_of_2">
								<input class="icon datepicker" type="text" name="expensedate" id="dtmExpenseDate" placeholder="&#xf073; date of expenditure" />
							</div>
						</div>
						<div class="section group">
								<textarea name="purpose" id="strPurpose" placeholder="purpose of the expenditure"></textarea>
						</div>
						<div class="section group">
								<input type="file" name="file-3[]" id="file-3" class="inputfile inputfile-3" />
								<label for="file-3"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"/></svg> <span>Upload a receipt&hellip;</span></label>
						</div>
						<div class="section group">
								<div class="col span_1_of_2">
										<select id="selExpenseCode" placeholder="select expense code"></select>
								</div>
								<div class="col span_1_of_2">
									<select id="selExpenseSubCode" placeholder="select expense subcode"></select>
								</div>
						</div>
						<div class="nav-center">
							<input id="btnNewClaimSubmit" type="submit" class="" value="Submit" />
						</div>
					</div>
			</div>
			<div class="md-modal md-effect-16" id="divReports">
					<div class="md-content">
						<h3><i class="fa fa-times md-close nav-right"></i>Search</h3>
						<div>
							<p>Enter the search criteria to look for specific claims</p>
							<div class="field">
								<label>Submitted By</label>
								<input type="text" name="username" id="strName" placeholder="full name" />
							</div>
							<div class="field">
								<label>Committee</label>
								<input  type="text" name="committee" id="strCommittee" placeholder="name" />
							</div>
						</div>
						<div class="nav-center">
							<input type="submit" class="" value="Search Claims" />
						</div>
					</div>
			</div>
			<div class="container">
				<div id="wrapper">
					<!-- Main -->
						<section id="home">
							<div class="section group">
								<div class="col span_1_of_2 nav-left">
									<span class="avatar"><img src="images/logo_bt.gif" alt="" height="60px" /></span>
								</div>
								<div class="col span_1_of_2 nav-right">
									<ul class="actions">
										<li>
											<input type="button" id="btnLogout" value="Logout" />
										</li>
									</ul>
								</div>
							</div>
							<br />
							<div class="table-wrapper card">
								<h2>Latest Active Claims</h2>
								<br />
								<table id="dtLatestClaims" class="display" width="100%">
									<thead>
										<tr>
											<th>Submitted By</th>
											<th>Status</th>
											<th>Amount</th>
											<th>Description</th>
											<th>Expense Type</th>
											<th>Committee</th>
											<th>Submitted Date</th>
											<th>Actions</th>
										</tr>
									</thead>
								</table>
							</div>
							<br/>
							<div class="table-wrapper card">
								<h2>Searched Claims</h2>
								<br />
								<table id="dtSearchedClaims" class="display" width="100%">
									<thead>
										<tr>
											<th>Submitted By</th>
											<th>Status</th>
											<th>Amount</th>
											<th>Description</th>
											<th>Expense Type</th>
											<th>Committee</th>
											<th>Submitted Date</th>
										</tr>
									</thead>
								</table>
							</div>
							<div class="section group">
								<div class="col span_1_of_2">
									<div class="card">
										<h2>Request a claim</h2>
										<div class="desc">Create a new claim request by specifying the expense type, amount, committee, etc.
											You may also upload an image of the receipt of your incurred expense for faster approval.
											Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore.
										</div>
										<input type="button" id="btnNewClaim" class="md-trigger" data-modal="divNewClaim" value="New Claim" />
										<label id="lblResult"></label>
									</div>
								</div>
								<div class="col span_1_of_2">
									<div class="card">
										<h2>Reporting</h2>
										<div class="desc">Search through current and previous submitted claims.
										Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
										Ut enim ad minim veniam.
										</div>
										<input id="btnReports" type="button" class="md-trigger" data-modal="divReports" value="Reports" />
									</div>
								</div>
							</div>
						</section>
					<!-- Footer -->
						<footer id="footer">
							<ul class="copyright">
								<li>&copy; Bharatiya Temple</li>
								<li>Designed by I.T. Team</a></li>
							</ul>
						</footer>
				</div>
			</div>
			<div class="md-overlay"></div>
		</form>
		<!-- Scripts -->
		<!--[if lte IE 8]><script src="assets/js/respond.min.js"></script><![endif]-->
		<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
		<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.13.0/jquery.validate.min.js"></script>
		<script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
		<script src="assets/js/classie.js"></script>
		<script src="assets/js/modalEffects.js"></script>
		<script src="assets/js/pikaday.js"></script>
		<script src="assets/js/pikaday.jquery.js"></script>
		<script src="assets/js/jquery.custom-file-input.js"></script>
		<script>
			var polyfilter_scriptpath = 'assets/js/css-filters-polyfill';
		</script>
		<script src="assets/js/cssParser.js"></script>
		<script src="assets/js/css-filters-polyfill.js"></script>
		<script>
			if ('addEventListener' in window) {
				window.addEventListener('load', function() { document.body.className = document.body.className.replace(/\bis-loading\b/, ''); });
				document.body.className += (navigator.userAgent.match(/(MSIE|rv:11\.0)/) ? ' is-ie' : '');
			}
		</script>
		<script>
			var username='';
			var claims = {};	
			var dtLatestClaims;
			
			function getLatestClaims(username){
				$.ajax({
					type: "GET",
					dataType: 'json',
					url: "http://localhost:8080/bt-db-layer-1.0-SNAPSHOT/claims/get", //json datasource
					headers: {username :  username},
					success: function(data){
						claims = (data);
						var dataTable = $('#dtLatestClaims').DataTable({
							data: data.claims,
							columns: [
								{data: "userName"},
								{data: "status"},
								{data: "price"},
								{data: "description"},
								{data: "expenseType"},
								{data: "committee"},
								{data: "submittedDate"}
							]
						});	
						console.log(claims);
					}
				});
			}
			
			function checkSession() {							
				//Check session values
				$.ajax({type: "GET",
						url: "http://localhost:8080/bt-db-layer-1.0-SNAPSHOT/session",
						data: {},
						success:function(response){
							var blnSession = response.isLoggedIn;
							username = response.username;
							if (blnSession === 'false'){
								window.location.href='index.html';
							} else {
								getLatestClaims(username);
								$('#strSubmittedBy').val(username);
							}
						}
					});
			}
			
			function populateExpenseDropdown() {
				 $.ajax({
						type: "GET",
						url: "http://localhost:8080/bt-db-layer-1.0-SNAPSHOT/expense/getAll",
						data: {},
						success: function (msg) {
							$("#selExpenseCode").append($('<option default></option>').val("0").html("select expense type"));
							$.each(msg, function (index, item) {
									$("#selExpenseCode").append("<option value='"+ item.expenseTypeId+"'>"+ item.expenseCode +"</option>");
							});
					   },
						error: function () {
							alert("Failed to load genders");
						}
				});
			}
			
			function populateExpenseSubType() {
				 $.ajax({
						type: "GET",
						url: "http://localhost:8080/bt-db-layer-1.0-SNAPSHOT/expense/getAllSubcodes/" + $("#selExpenseCode").val(),
						data: {},
						success: function (msg) {
							$("#selExpenseSubCode").empty();
							$("#selExpenseSubCode").append($('<option default></option>').val("0").html("select expense type"));
							$.each(msg, function (index, item) {
									$("#selExpenseSubCode").append("<option value='"+ item.expenseSubCode+"'>"+ item.expenseSubCodeDescription +"</option>");
							});
					   },
						error: function () {
							alert("Failed to load genders");
						}
				});
			}
			
		// When the document is ready
			$(document).ready(function() {	
				
				checkSession();
				populateExpenseDropdown();
				
				$("#selExpenseCode").on('change', function(e){
					 populateExpenseSubType();
				});
			
				// activate datepickers for all elements with a class of `datepicker`
				$('.datepicker').pikaday({ firstDay: 1});
								
				$("#btnLogout").on('click', function(e){
				  e.preventDefault();
					$.ajax({type: "GET",
							url: "http://localhost:8080/bt-db-layer-1.0-SNAPSHOT/logout",
							data: {},
							success:function(){
								window.location.href='index.html';
					}});
				});
				
				
				//New claim submit
				$("#btnNewClaimSubmit").on('click', function(e){
				  e.preventDefault();
				  
					//Collect data from textbox and validate
					var objRecipientData = {
						firstName : $('#strCheckFName').val(),
						lastName : $('#strCheckFName').val(),
						nameOnCheck : $('#strCheckFName').val() + ' ' + $('#strCheckFName').val(),
						address : $('#strAddress').val(),
						city : $('#strCity').val(),
						state : $('#strState').val(),
						zip: $('#strZip').val()
					};
					
					var objClaimsData = {
						username : $('#strSubmittedBy').val(),
						committee : 'RELIGIOUS',
						price : $('#strAmount').val(),
						expenseType : $('#selExpenseCode option:selected').text(),
						description : $('#strPurpose').val(),
						imagePath : "http://www.godady.com/image_1234"
					};
					
					$.ajax({type: "POST",
							url: "http://localhost:8080/bt-db-layer-1.0-SNAPSHOT/claims/submit",
							data: JSON.stringify({claimsData :  objClaimsData,recipientData:  objRecipientData}),
							contentType : "application/json",
							headers : {"Accept" : "application/json","Content-Type" : "application/json"},
							dataType : "json",
							success: function(data){
								if (data.status === 'success') {
									$('#lblResult').text('Expense added successfully');
									dtLatestClaims.fnDraw();
								}
					}});
					
					
				});
				
				/*Search claims*/
				$('#dtSearchedClaims').DataTable({});
				
			});
		</script>
	</body>
</html>